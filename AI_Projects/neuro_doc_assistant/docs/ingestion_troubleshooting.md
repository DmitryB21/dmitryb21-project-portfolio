# Устранение неполадок индексации

## Проблема: "Директория с данными не найдена"

### Описание
При запуске индексации появляется ошибка:
```
❌ Ошибка: Директория с данными не найдена: D:\...\data\NeuroDoc_Data
```

### Причины

1. **Документы уже в S3** - документы были мигрированы в S3 хранилище, но скрипт пытается загрузить из локальной директории
2. **Локальная директория не существует** - файлы не были скопированы в `data/NeuroDoc_Data/`
3. **Неправильная настройка источника данных**

### Решения

#### Решение 1: Использовать S3 хранилище (рекомендуется)

Если документы уже в S3 (MinIO или SberCloud Object Storage):

1. Убедитесь, что переменные окружения настроены в `.env`:
```env
S3_ENDPOINT=http://localhost:9000
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin123
S3_BUCKET=neuro-doc-docs
USE_S3_STORAGE=true
```

2. Проверьте наличие документов в S3:
```bash
python scripts/check_storage.py
```

3. Запустите индексацию - скрипт автоматически обнаружит документы в S3

#### Решение 2: Использовать локальную файловую систему

Если документы находятся локально:

1. Убедитесь, что директория существует:
```bash
# Windows
dir data\NeuroDoc_Data

# Linux/Mac
ls -la data/NeuroDoc_Data
```

2. Если директория не существует, создайте её и скопируйте документы:
```bash
mkdir -p data/NeuroDoc_Data/hr
mkdir -p data/NeuroDoc_Data/it
# Скопируйте .md файлы в соответствующие директории
```

3. Установите в `.env`:
```env
USE_S3_STORAGE=false
```

4. Запустите индексацию

#### Решение 3: Автоматическое определение (по умолчанию)

Скрипт автоматически:
1. Проверяет наличие документов в S3 (если `USE_S3_STORAGE=auto` или не установлен)
2. Если S3 пуст или недоступен, переключается на локальную файловую систему
3. Если локальная директория не найдена, выдает ошибку

### Проверка текущего состояния

```bash
# Проверка S3
python -c "from app.storage.s3_storage import S3DocumentStorage; s = S3DocumentStorage(); print(f'Документов в S3: {len(s.list_documents())}')"

# Проверка локальной директории
python -c "from pathlib import Path; d = Path('data/NeuroDoc_Data'); print(f'Локальная директория существует: {d.exists()}')"
```

### Логика работы скрипта

```
1. Проверка USE_S3_STORAGE в .env
   ├─ Если "true" или "auto" → пробуем S3
   │  ├─ Если S3 доступен и есть документы → используем S3 ✅
   │  └─ Если S3 пуст/недоступен → переключаемся на local
   └─ Если "false" → используем local

2. Проверка локальной файловой системы
   ├─ Если data/NeuroDoc_Data существует → используем local ✅
   └─ Если не существует → ошибка ❌
```

### Рекомендации

- **Для production**: Используйте S3 хранилище (`USE_S3_STORAGE=true`)
- **Для разработки**: Можно использовать локальную файловую систему
- **Автоматический режим**: `USE_S3_STORAGE=auto` (по умолчанию) - скрипт сам выберет источник

