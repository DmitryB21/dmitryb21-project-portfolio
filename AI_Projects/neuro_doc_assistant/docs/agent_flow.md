üß† Neuro_Doc_Assistant ‚Äî –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –∞–≥–µ–Ω—Ç–∞
1. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞

agent_flow.md –æ–ø–∏—Å—ã–≤–∞–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É AI-–∞–≥–µ–Ω—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞ Neuro_Doc_Assistant.
–î–æ–∫—É–º–µ–Ω—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç:

–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–∑–æ–≤–∞ –º–æ–¥—É–ª–µ–π

state machine –∞–≥–µ–Ω—Ç–∞

–ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

—Å–≤—è–∑—å —Å UC –∏ —Ç–µ—Å—Ç-–∫–µ–π—Å–∞–º–∏

–í—Å–µ —à–∞–≥–∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º—ã, –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∫ Faithfulness, Precision@3 –∏ latency.

2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –æ–±–∑–æ—Ä Agent Layer
2.1 Agent Layer

–¢–∏–ø: Lightweight, deterministic

–†–æ–ª—å: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–º–∏, —Ñ–∏–∫—Å–∞—Ü–∏—è —Ä–µ—à–µ–Ω–∏—è

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

AgentController ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π orchestrator

AgentStateMachine ‚Äî –∫–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π

DecisionLog ‚Äî —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ –∞–≥–µ–Ω—Ç–∞

2.2 –¶–µ–ª–∏ –∞–≥–µ–Ω—Ç–∞

–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—Ç—Ä–æ–≥–æ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

–ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π

–ü–æ–¥–¥–µ—Ä–∂–∫–∞ R&D —Ü–∏–∫–ª–∞ –∏ –º–µ—Ç—Ä–∏–∫

–ì–∏–±–∫–∞—è —Ä–∞–±–æ—Ç–∞ —Å retrieval, reranking, –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π

3. State Machine –∞–≥–µ–Ω—Ç–∞
| –°–æ—Å—Ç–æ—è–Ω–∏–µ             | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ         | –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ                    | –î–µ–π—Å—Ç–≤–∏—è                               | –í—ã—Ö–æ–¥                              |
| --------------------- | ------------------ | --------------------------------- | -------------------------------------- | ---------------------------------- |
| IDLE                  | –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞   | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å           | -                                      | –ü–µ—Ä–µ—Ö–æ–¥ ‚Üí VALIDATE_QUERY           |
| VALIDATE_QUERY        | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—Ä–æ—Å–∞   | –í—Ö–æ–¥–Ω–æ–π —Ç–µ–∫—Å—Ç                     | –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–ª–Ω–æ—Ç—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞          | CONTEXT_OK / REQUEST_CLARIFICATION |
| REQUEST_CLARIFICATION | –ó–∞–ø—Ä–æ—Å —É—Ç–æ—á–Ω–µ–Ω–∏–π   | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç            | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É—Ç–æ—á–Ω—è—é—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞          | Awaiting user input                |
| RETRIEVE              | Semantic search    | –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å             | –í—ã–∑–æ–≤ `Retriever`, –ø–æ–∏—Å–∫ —Ç–æ–ø-K —á–∞–Ω–∫–æ–≤  | retrieved_chunks                   |
| METADATA_FILTER       | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è         | retrieved_chunks + –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ     | –í—ã–∑–æ–≤ `MetadataFilter`                 | filtered_chunks                    |
| RERANK                | (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)      | filtered_chunks                   | –í—ã–∑–æ–≤ `Reranker`                       | reranked_chunks                    |
| GENERATE              | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞   | reranked_chunks / filtered_chunks | –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ prompt, –≤—ã–∑–æ–≤ `LLMClient` | answer                             |
| VALIDATE_ANSWER       | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞  | answer                            | –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Faithfulness, Precision    | VALID / INVALID                    |
| LOG_METRICS           | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ        | –ú–µ—Ç—Ä–∏–∫–∏ –æ—Ç–≤–µ—Ç–∞                    | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PostgreSQL + Prometheus   | logged                             |
| RETURN_RESPONSE       | –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ | answer + sources                  | –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é                  | IDLE                               |

4. –ú–æ–¥—É–ª–∏ –∞–≥–µ–Ω—Ç–∞ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
4.1 –ú–æ–¥—É–ª—å Ingestion & Indexing

–ó–∞–¥–∞—á–∏:

–∑–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (PDF, DOCX, MD, TXT)

–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞

—á–∞–Ω–∫–∏–Ω–≥ (200‚Äì400 —Ç–æ–∫–µ–Ω–æ–≤)

–≥–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings

–∑–∞–≥—Ä—É–∑–∫–∞ –≤ Qdrant

–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: DocumentLoader, Chunker, EmbeddingService, QdrantIndexer

–°–≤—è–∑–∞–Ω–Ω—ã–µ UC: UC-1, UC-6

4.2 –ú–æ–¥—É–ª—å Metadata & Storage

–ó–∞–¥–∞—á–∏:

—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤

–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: MetadataRepository, ExperimentRepository

–°–≤—è–∑–∞–Ω–Ω—ã–µ UC: UC-3, UC-6

4.3 –ú–æ–¥—É–ª—å Retrieval Layer

–ó–∞–¥–∞—á–∏:

semantic search –≤ Qdrant

—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º

–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è K

–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: Retriever, MetadataFilter

–°–≤—è–∑–∞–Ω–Ω—ã–µ UC: UC-1, UC-3, UC-5

4.4 –ú–æ–¥—É–ª—å Reranking

–ó–∞–¥–∞—á–∏:

–ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ retrieved –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å / –±–µ–∑ reranking

–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: Reranker

–°–≤—è–∑–∞–Ω–Ω—ã–µ UC: UC-4, UC-6

4.5 –ú–æ–¥—É–ª—å Generation Layer

–ó–∞–¥–∞—á–∏:

—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ prompt

–≤—ã–∑–æ–≤ GigaChat API

—Å—Ç—Ä–æ–≥–æ–µ —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ ¬´–æ—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É¬ª

–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: PromptBuilder, LLMClient

–°–≤—è–∑–∞–Ω–Ω—ã–µ UC: UC-1, UC-5

4.6 –ú–æ–¥—É–ª—å Evaluation & Metrics

–ó–∞–¥–∞—á–∏:

—Ä–∞—Å—á—ë—Ç Precision@K

–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è RAGAS

—Å–±–æ—Ä latency / throughput

–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: MetricsCollector, RAGASEvaluator

–°–≤—è–∑–∞–Ω–Ω—ã–µ UC: UC-6, UC-7

4.7 Agent Layer (State Machine)

–ó–∞–¥–∞—á–∏:

–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π

—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–º–∏ –ø—Ä–æ–≥–æ–Ω–∞–º–∏

—Ñ–∏–∫—Å–∞—Ü–∏—è DecisionLog

–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: AgentController, AgentStateMachine, DecisionLog

–°–≤—è–∑–∞–Ω–Ω—ã–µ UC: UC-1, UC-4, UC-6

4.8 API & UI Layer

–ó–∞–¥–∞—á–∏:

REST API (FastAPI)

demo UI (Streamlit / Gradio)

–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫

–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: QueryAPI, AdminAPI, DemoUI

–°–≤—è–∑–∞–Ω–Ω—ã–µ UC: UC-1, UC-2, UC-7

5. DecisionLog

–§–∏–∫—Å–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ –º–æ–¥—É–ª—è, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

–ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—ã–π execution flow.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è R&D –∞–Ω–∞–ª–∏–∑–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫.

6. –ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ (–ø—Ä–∏–º–µ—Ä)

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å ‚Üí IDLE ‚Üí VALIDATE_QUERY

–ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ–ø–æ–ª–Ω—ã–π ‚Üí REQUEST_CLARIFICATION

RETRIEVE ‚Üí METADATA_FILTER ‚Üí RERANK (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

GENERATE ‚Üí VALIDATE_ANSWER

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

DecisionLog —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –≤—Å–µ —à–∞–≥–∏


7. –°–≤—è–∑—å —Å UC –∏ —Ç–µ—Å—Ç–∞–º–∏

| UC   | –û–ø–∏—Å–∞–Ω–∏–µ               | –ü—Ä–æ–≤–µ—Ä–∫–∞                           |
| ---- | ---------------------- | ---------------------------------- |
| UC-1 | –ë–∞–∑–æ–≤—ã–π –ø–æ–∏—Å–∫          | —Ç–µ—Å—Ç—ã –≤ `test_uc1_basic_search.py` |
| UC-3 | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ             | `MetadataFilter`                   |
| UC-4 | Reranking              | —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ Precision@3              |
| UC-5 | –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏         | –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞       |
| UC-6 | –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Ü–∏–∫–ª | —Ñ–∏–∫—Å–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫                    |
| UC-7 | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥             | Prometheus + Grafana               |
| UC-8 | Demo / Stakeholders    | UI –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏  |


