<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–¢—Ä–µ–Ω–¥—ã (Standalone)</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <script src="env.js"></script>
    <script src="assets/js/common.js"></script>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="brand"><strong>–¢—Ä–µ–Ω–¥—ã</strong> <span class="muted">Standalone</span></div>
        <div class="nav">
          <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
          <a href="trends.html">–¢—Ä–µ–Ω–¥—ã</a>
          <a href="search.html">–ü–æ–∏—Å–∫</a>
        </div>
      </div>

      <div class="card">
        <div class="controls">
          <button id="btn-daily" class="btn active" data-period="daily">üìÖ –ó–∞ –¥–µ–Ω—å</button>
          <button id="btn-weekly" class="btn" data-period="weekly">üìÜ –ó–∞ –Ω–µ–¥–µ–ª—é</button>
          <button id="btn-monthly" class="btn" data-period="monthly">üìä –ó–∞ –º–µ—Å—è—Ü</button>
        </div>
        <div id="trends-list" class="trends-list">
          <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
      </div>
    </div>

    <script>
      let currentPeriod = 'daily';
      const buttons = ['btn-daily','btn-weekly','btn-monthly'];
      buttons.forEach(id => {
        const el = document.getElementById(id);
        el.addEventListener('click', () => {
          buttons.forEach(i => document.getElementById(i).classList.remove('active'));
          el.classList.add('active');
          currentPeriod = el.getAttribute('data-period');
          loadTrends();
        });
      });

      async function loadTrends() {
        try {
          const data = await apiGet(`/pro/api/trends?period=${currentPeriod}&limit=20`);
          const list = document.getElementById('trends-list');
          list.innerHTML = '';
          (data.trends || []).forEach((trend, index) => {
            const item = document.createElement('div');
            item.className = 'trend-item';
            const title = trend.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
            const color = trend.topic_color || '#3b82f6';
            const messageCount = trend.message_count ?? 0;
            const channelCount = trend.channel_count ?? 0;
            const avgSim = (trend.avg_similarity ?? 0).toFixed(2);
            const dir = trend.trend_direction || 'stable';
            const icon = trend.trend_icon || '‚û°Ô∏è';
            const growth = (trend.growth_percentage ?? 0);
            item.innerHTML = `
              <div class="trend-rank">${index + 1}</div>
              <div class="trend-info">
                <div class="trend-name" style="color: ${color}">${escapeHtml(title)}</div>
                <div class="trend-metrics">
                  <span class="trend-metric">${formatNumber(messageCount)} —É–ø–æ–º–∏–Ω–∞–Ω–∏–π</span>
                  <span class="trend-metric">${formatNumber(channelCount)} –∫–∞–Ω–∞–ª–æ–≤</span>
                  <span class="trend-metric">–°—Ö–æ–∂–µ—Å—Ç—å: ${avgSim}</span>
                  <span class="trend-growth ${dir}">${icon} ${growth > 0 ? '+' : ''}${growth}%</span>
                </div>
              </div>
            `;
            list.appendChild(item);
          });
        } catch (e) {
          document.getElementById('trends-list').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–µ–Ω–¥–æ–≤</div>';
        }
      }

      loadTrends();
    </script>
  </body>
</html>


