<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pro Dashboard (Standalone)</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <script src="env.js"></script>
    <script src="assets/js/common.js"></script>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="brand">
          <strong>Pro Dashboard</strong> <span class="muted">Standalone</span>
        </div>
        <div class="nav">
          <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
          <a href="trends.html">–¢—Ä–µ–Ω–¥—ã</a>
          <a href="search.html">–ü–æ–∏—Å–∫</a>
        </div>
      </div>

      <div class="grid">
        <div class="col-12">
          <div class="card">
            <h3 class="section-title">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <div id="stats" class="grid">
              <div class="col-3">
                <div class="card">
                  <div class="muted">–°–æ–æ–±—â–µ–Ω–∏–π</div>
                  <div id="stat-total-messages" style="font-size: 22px; font-weight: 700;">‚Äî</div>
                </div>
              </div>
              <div class="col-3">
                <div class="card">
                  <div class="muted">–°–æ–±—ã—Ç–∏–π</div>
                  <div id="stat-total-events" style="font-size: 22px; font-weight: 700;">‚Äî</div>
                </div>
              </div>
              <div class="col-3">
                <div class="card">
                  <div class="muted">–¢–µ–º</div>
                  <div id="stat-total-topics" style="font-size: 22px; font-weight: 700;">‚Äî</div>
                </div>
              </div>
              <div class="col-3">
                <div class="card">
                  <div class="muted">–ö–∞–Ω–∞–ª–æ–≤</div>
                  <div id="stat-total-channels" style="font-size: 22px; font-weight: 700;">‚Äî</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-6">
          <div class="card">
            <h3 class="section-title">üî• –¢–æ–ø —Ç—Ä–µ–Ω–¥—ã —Å–µ–≥–æ–¥–Ω—è</h3>
            <div id="trends-list" class="trends-list">
              <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
          </div>
        </div>

        <div class="col-6">
          <div class="card">
            <h3 class="section-title">üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</h3>
            <div id="events-list" class="events-list">
              <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      async function loadStats() {
        try {
          const data = await apiGet('/pro/api/stats');
          document.getElementById('stat-total-messages').textContent = formatNumber(data.total_messages || 0);
          document.getElementById('stat-total-events').textContent = formatNumber(data.events_count || 0);
          document.getElementById('stat-total-topics').textContent = formatNumber(data.topics_count || 0);
          document.getElementById('stat-total-channels').textContent = formatNumber(data.channels_count || 0);
        } catch (e) {
          document.getElementById('stats').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</div>';
        }
      }

      async function loadTrends() {
        try {
          const data = await apiGet('/pro/api/trends?period=daily&limit=5');
          const list = document.getElementById('trends-list');
          list.innerHTML = '';
          (data.trends || []).forEach((trend, index) => {
            const item = document.createElement('div');
            item.className = 'trend-item';
            const title = trend.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
            const color = trend.topic_color || '#3b82f6';
            const messageCount = trend.message_count ?? 0;
            const channelCount = trend.channel_count ?? 0;
            const dir = trend.trend_direction || 'stable';
            const icon = trend.trend_icon || '‚û°Ô∏è';
            const growth = (trend.growth_percentage ?? 0);
            item.innerHTML = `
              <div class="trend-rank">${index + 1}</div>
              <div class="trend-info">
                <div class="trend-name" style="color: ${color}">${escapeHtml(title)}</div>
                <div class="trend-metrics">
                  <span class="trend-metric">${formatNumber(messageCount)} —É–ø–æ–º–∏–Ω–∞–Ω–∏–π</span>
                  <span class="trend-metric">${formatNumber(channelCount)} –∫–∞–Ω–∞–ª–æ–≤</span>
                  <span class="trend-growth ${dir}">${icon} ${growth > 0 ? '+' : ''}${growth}%</span>
                </div>
              </div>
            `;
            list.appendChild(item);
          });
        } catch (e) {
          document.getElementById('trends-list').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–µ–Ω–¥–æ–≤</div>';
        }
      }

      async function loadRecentEvents() {
        try {
          const data = await apiGet('/pro/api/feed?limit=5');
          const list = document.getElementById('events-list');
          list.innerHTML = '';
          (data.events || []).forEach(ev => {
            const item = document.createElement('div');
            item.className = 'event-item';
            const title = ev.title || (ev.summary ? ev.summary.substring(0, 100) : '–°–æ–±—ã—Ç–∏–µ –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è');
            const msgCount = ev.message_count ?? 0;
            const channels = ev.channel_names ? ev.channel_names.length : 0;
            item.innerHTML = `
              <div class="event-title">${escapeHtml(title)}</div>
              <div class="event-meta">${formatNumber(msgCount)} —Å–æ–æ–±—â–µ–Ω–∏–π ‚Ä¢ ${formatNumber(channels)} –∫–∞–Ω–∞–ª–æ–≤</div>
            `;
            list.appendChild(item);
          });
        } catch (e) {
          document.getElementById('events-list').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π</div>';
        }
      }

      (async () => {
        await Promise.all([loadStats(), loadTrends(), loadRecentEvents()]);
      })();
    </script>
  </body>
</html>


